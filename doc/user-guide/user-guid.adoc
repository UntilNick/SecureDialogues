:product: SecureDialogues

:confidential:
:sectnums:
:toc: auto
:toclevels: 3
:xrefstyle: short

:lang: ru
:appendix-caption: Приложение
:example-caption: Пример
:figure-caption: Рисунок
:last-update-label: Обновлено
:listing-caption: Листинг
:table-caption: Таблица
:toc-title: Содержание
:version-label: Версия

:subtitle: Руководство пользователя
:revdate: 23/04/2018
:draft:


= SecureDialogues: {subtitle}


== Общие сведения

Приложение `SecureDialogues` добавляет уровень шифрования сообщений, которые передаются через такие сервисы, как
*Gmail*. Список сервисов на данный момент состоит из:  *Gmail* и *UDP*, но ведутся работы по его расширению.

Для аунтификации собеседника используется электронная подпись, формирование которой обеспечивается алгоритмом *RSA*.
Передача сообщений защищена шифрованием по алгоритму *AES* с применением 256-битных сессионных ключей.
Так же все данные пользователей, которые находятся на жестком диске, зашифрованы.

== Термины

В этом разделе описаны несколько терминов, которые упростят дальнейшее описание принципов работы приложения.

[#chanel-defenition]
*Сервис передачи сообщений* - сторонний сервис, которой обеспечивает доставку сообщений между собеседниками, например *Gmail*.

[#contact-definition]
*Контакт* - удаленный собеседник, которому через <<chanel-defenition, сервис>> отправляются сообщения. Если проводить аналогию с
электронной почтой, то это адрес, с которым производится взаимодействие через конкретный почтовый ящик.

[#dialog-definition]
*Диалог* - весь обмен сообщениями происходит в рамках конкретного диалога. Так же для каждого диалога производится
генерация сеансовых ключей.

== Интерфейс пользователя

=== Запуск приложения

После запуска приложения появится диалоговое окно с предложением ввести пароль:

image::{staticdir}/password-promt.png[password]

Если это первый запуск программы, то введённый пароль будет использоваться для шифрования всех
данных приложения. Для последующих запусков  пароль используется для дешифрования.

Общий вид главного окна приложения показан на рисунке ниже:

image::{staticdir}/main-window.png[main window]

=== Добавление сервисов

Для первоначальной настройки приложения необходимо в меню *Контроль > Сервисы* добавить один или несколько сервисов, через которые будет осуществляться
передача сообщений.
После клика на указанный пункт меню появится диалоговое окно, в котором предложено выбрать тип сервиса и указать его
характеристики:

image::{staticdir}/channel-creation.png[channel creation]


Приложение отслеживает состояние подключения к сервису. Информация об этом отображается при просмотре уже созданного
сервиса:

image::{staticdir}/channel-status.png[channel status]

==== UDP

Для *UDP*  достаточно указать только имя. После сохранения,
имя сервиса появится в списке слева, как показано на рисунке ниже:

image::{staticdir}/channel-creation-created.png[channel creation]

==== Gmail

Для работы через *Gmail* необходимо получить *OAuth2 token*, для этого щелкните по ссылке в окне *Открыть страницу получения Oauth2 кода*.

image::{staticdir}/gmail-channel.png[gmail channel]

В открывшемся окне браузера на странице *https://accounts.google.com* Вам будет предложено авторизоваться. После авторизации появится окно с кодом:

image::{staticdir}/gmail-token.png[gmail token]

Необходимо этот код скопировать в поле *Token*, а в поле *E-mail* поместить *e-mail* адрес Вашего аккаунта *Gmail* и сохранить изменения:

image::{staticdir}/saved-gmail-channel.png[gmail channel]

В результате сообщения будут отправляться через указанный почтовый ящик в зашифрованном виде.

==== VK

Для передачи сообщений через *ВКонтакте* необходимо добавить соответствующий сервис. Для этого
щелкните по ссылке - *Открыть страницу получения Oauth2 кода*:

image::{staticdir}/vk-service-setup.png[vk channel]

В открывшемся окне браузера на странице *https://oauth.vk.com/authorize* Вам будет предложено авторизоваться и подтвердить доступ приложения к 
Вашему аккаунту:

image::{staticdir}/vk-access.png[vk access]

После клика на кнопку *Разрешить*, будет осуществлен переход на новую страницу *https://oauth.vk.com/blank.html*.
Вид *URL* будет иметь вид:

```
https://oauth.vk.com/blank.html#access_token=<token>&expires_in=0&user_id=<user id>
```

Где:

* *token* ключ, который используется для авторизации приложения;
* *user id* Ваш идентификатор *VK*.

Этот адрес необходимо вставить в поле *URL*.

К примеру, для 
https://oauth.vk.com/blank.html#access_token=*098942afdc9cadaf00896aaa*&expires_in=0&user_id=*13455*,
настройка сервиса будет выглядеть следующим образом:

image::{staticdir}/vk-channel-filled.png[vk filled]

==== E-mail

В приложение добавлена возможность организовать работу по *e-mail*. В этом случае
для отправки используется протокол *SMTP*, а для получения  - *IMAP*.

Вид окна для создания подключения показан ниже:

image::{staticdir}/channel-email.png[channel email]

В диалоге необходимо заполнить логин и пароль для подключения к *IMAP* и *SMTP* серверам,
а так же поле *From* валидным *e-mail*-адресом. Значение из этого поля будет вставляться в
соответствующий заголовок отправляемых сообщений.

Ниже приведен пример конфигурации для сервиса *Gmail*
( более подробно по https://support.google.com/mail/answer/7126229?hl=ru[ссылке] ):

image::{staticdir}/chanel-email-for-gmail.png[chanel email for gmail]



=== Добавление контактов

После того, как добавлен хоты бы один сервис, можно перейти к добавлению контактов, с которыми будет происходить взаимодействие.

Для этого необходимо в меню *Контроль > Контакты* создать новый в появившемся диалоговом окне:

image::{staticdir}/contact-creation.png[channel creation]

Здесь указываются:

* *сервис*, через который будет происходить общение с контактом;
* *имя*, которое будет отображаться в пользовательском интерфейсе;
* *адрес* контакта в выбранном канале связи. Для *UDP* это *IP*-адрес;
* *публичный ключ*  для проверки подписи и шифрования сеансового ключа.

Формат адреса зависит от типа подключения:

* для *UDP* необходим *IP*-адрес
* для *VK* используется, либо ссылка на страницу собеседника - *https://vk.com/id10001*,
либо просто просто идентификатор пользователя - *id10001*, либо без префикса - *10001*.
* для *Gmail* или *Email* указывается валидный *e-mail*.

После сохранения контакта, он будет отображаться в этом же диалоге, но в списке слева. Для удобства
отображается имя и адрес:

image::{staticdir}/contact-created.png[channel creation]

Пример заполнения контакта для *VK*:

image::{staticdir}/contact-vk-filled.png[contact vk filled]

Пример заполнения контакта для *E-mail*:

image::{staticdir}/contact-email-filled.png[contact email filled]

Свой публичный ключ можно посмотреть, если перейти в пункт меню *Публичный ключ > Показать*:

image::{staticdir}/public-key-display.png[channel creation]

=== Создание диалога

Теперь, когда созданы контакт и диалог, становится доступно создание диалога.

*Прежде чем диалог может быть создан, удаленный собеседник так же должен добавить Вас в свои контакты, указав правильно публичный ключ!*

Для создания диалога в главном окне необходимо щелкнуть на кнопку *Начать диалог*. Появится диалоговое окно, в котором будет предложено выбрать
один из контактов, с которым должен быть организован диалог:

image::{staticdir}/dialog-creation.png[channel creation]

Система запросит подтверждение создания диалога:


image::{staticdir}/dialog-confirmation.png[channel creation]

После подтверждения, удаленный собеседник получит сообщение о вашем намерении создать диалог:

image::{staticdir}/remote-peer-create-dialog-info.png[channel creation]

И в главном окне в списке слева отобразится создаваемый диалог:

image::{staticdir}/dialog-creation-info.png[channel creation]

Для подтверждения создания  диалога удаленному собеседнику достаточно выбрать в списке слева диалог, щелкнуть на него правой кнопкой мыши
и выбрать в контекстном меню *Подтвердить создание*.


=== Отправка сообщений

После подтверждения создания диалога удаленным пользователем, Вы получите сообщение:

image::{staticdir}/dialog-creation-confirmed.png[channel creation]

После этого можно отправлять и принимать сообщения, но только после того, как будет выбран диалог. Чтобы это осуществить, щелкните по диалогу с списке
слева, в главном окне:

image::{staticdir}/message-sending.png[channel creation]

Сообщения удаленного пользователя отображаются слева, а Ваши - справа:

image::{staticdir}/message-sending-1.png[channel creation]


Приложение сортирует список диалогов в следующем порядке - в самом верху будут активные диалоги, для которых разрешена отправка
сообщений, а в самом низу - закрытые. Так же на порядок влияет время изменения диалога. Активный диалог, который последним получил сообщение
будет выше всех, а первый закрытый - внизу.  Для каждого диалога показывается индикатор количества непрочитанных сообщений, при их наличии.

image::{staticdir}/unread-messages.png[channel creation]

Статус диалога выделяется цветом:

* *красным* отмечаются закрытые диалоги
* *зеленым* показаны активные диалоги, для них возможно отправлять сообщения
* *серые* диалоги находятся в процессе создания.


Для того, чтобы скопировать сообщение, необходимо кликнуть на него два раза, после этого текст
можно будет выделить:

image::{staticdir}/message-copy.png[message copy]




